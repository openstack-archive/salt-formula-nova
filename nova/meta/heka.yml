log_collector:
  decoder:
    nova:
      engine: sandbox
      module_file: /usr/share/lma_collector/decoders/openstack_log.lua
      module_dir: /usr/share/lma_collector/common;/usr/share/heka/lua_modules
      {%- if salt['pillar.get']('linux:system:timezone') %}
      config:
        tz: "{{ salt['pillar.get']('linux:system:timezone') }}"
      {%- endif %}
    {%- if pillar.nova.compute is defined %}
    libvirt:
      engine: sandbox
      module_file: /usr/share/lma_collector/decoders/libvirt_log.lua
      module_dir: /usr/share/lma_collector/common;/usr/share/heka/lua_modules
    {%- endif %}
  splitter:
    nova:
      engine: token
      delimiter: '\n'
  input:
    nova_log:
      engine: logstreamer
      log_directory: "/var/log/nova"
      file_match: '(?P<Service>.+)\.log\.?(?P<Seq>\d*)$'
      differentiator: ['nova', '_', 'Service']
      priority: ["^Seq"]
      decoder: "nova_decoder"
      splitter: "nova_splitter"
    {%- if pillar.nova.compute is defined %}
    libvirt_log:
      engine: logstreamer
      log_directory: "/var/log/libvirt"
      file_match: 'libvirtd.log'
      differentiator: ['libvirt']
      decoder: "libvirt_decoder"
      splitter: "TokenSplitter"
    {%- endif %}
