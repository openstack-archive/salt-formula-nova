{%- if pillar.nova.compute is defined %}
local_plugin:
  nova_compute_libvirt:
    plugin: libvirt
    template: nova/files/collectd_libvirt.conf
  collectd_libvirt_check:
    plugin: python
    template: collectd/files/collectd_libvirt_check.conf
{%- endif %}
{%- if pillar.nova.controller is defined %}
{% from "nova/map.jinja" import controller with context %}
remote_plugin:
  nova_openstack_nova_{{ grains.host }}:
    plugin: python
    template: collectd/files/collectd_openstack_nova.conf
    host: {{ controller.bind.public_address }}
    port: 5000
    project: services
    user: nova
    password: {{ controller.identity.password }}
{%- endif %}
